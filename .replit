run = "npm run start:prod"
build = "npm run build"
entrypoint = "src/main.tsx"

[env]
VITE_PORT = "5173"
VITE_PUBLIC_URL = "https://sheltr-ops.replit.app"
NODE_ENV = "production"
VITE_APP_ENV = "production"
VITE_ENABLE_MONITORING = "true"
VITE_SECURITY_MONITORING = "true"
PATH = "${HOME}/.nix-profile/bin:/nix/var/nix/profiles/default/bin:${PATH}"

[nix]
channel = "stable-23_11"

[deployment]
run = [
  "bash",
  "-c",
  "export PATH=/nix/var/nix/profiles/default/bin:$PATH && npm ci --ignore-engines && npm run start:prod"
]
deploymentTarget = "cloudrun"
ignorePorts = false
publicDir = "dist"
build = [
  "bash",
  "-c",
  "export PATH=/nix/var/nix/profiles/default/bin:$PATH && npm ci --ignore-engines && npm run build"
]